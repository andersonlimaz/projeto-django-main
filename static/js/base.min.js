function validate_cpf(a){if(""==(a=a.replace(/[^\d]+/g,"")))return!1;for(var e=0,t=0,o=0;o<9;o++)e+=parseInt(a.charAt(o))*(10-o);if(10!=(t=11-e%11)&&11!=t||(t=0),t!=parseInt(a.charAt(9)))return!1;e=0;for(o=0;o<10;o++)e+=parseInt(a.charAt(o))*(11-o);return 10!=(t=11-e%11)&&11!=t||(t=0),t==parseInt(a.charAt(10))}function clean_all_url_parameters(){original_url=window.location.href,url=original_url,url=url.split("?"),base_url=url[0],parameters=url[1],parameters=parameters.split("&"),analytics="",notClean="",$.each(parameters,(function(a,e){e=e.split("="),name=e[0],value=e[1],"utm_source"==name||"utm_medium"==name||"utm_campaign"==name||"utm_content"==name||"utm_term"==name||"_hjFormSelectorTrsToken"==name||"term_lgpd"==name||"bg_mobile"==name?analytics=analytics+"&"+name+"="+value:"exp"==name&&(notClean=name+"="+value)})),analytics=analytics.substring(1),notClean&&analytics||notClean||(analytics?(final_url=base_url+"?"+analytics,window.history.pushState("","",final_url)):(final_url=base_url,window.history.pushState("","",final_url)))}function get_url_parameter(a){var e=window.original_url.split("?")[1];if(e)for(var t=e.split("&"),o=0;o<t.length;o++){var i=t[o].split("=");if(i[0]==a)return i[1]}}function get_all_url_parameters(){var a=window.original_url.split("?")[1];if(a){for(var e=a.split("&"),t={},o=0;o<e.length;o++){var i=e[o].split("=");t[i[0]]=decodeURIComponent(i[1].replace(/[+]/g," "))}return t}}function rand(a,e){return Math.floor(Math.random()*(e-a+1))+a}function vertical_align(){var a=$(".vertical-align");window.innerWidth>992?a.each((function(a,e){var t=$(this).height(),o=$(this).attr("data-vertical-align-parent"),i=((o?$(this).parents(o).height():$(this).parent().height())-t)/2;$(this).css("margin-top",i>0?i:0)})):a.css("margin-top","")}function logout(a){Cookies.set("login",0),$(".login--toolbar").hide();for(var e=0;e<fields_to_storage_in_cookies.length;e++)Cookies.remove(fields_to_storage_in_cookies[e]);a&&(window.location.href=window.location.href+(window.location.search?"&":"?")+"login=0")}function user_is_logged_in(){return 1==get_url_parameter("login")||1==Cookies.get("login")}function user_is_logged_out(){return!user_is_logged_in()}function field_is_storaged_in_cookie(a){return $.inArray(a,fields_to_storage_in_cookies)>-1}function get_all_cookies(){return{collaborator:Cookies.get("collaborator")||"",first_visit:Cookies.get("first_visit")||"",login:Cookies.get("login")||"",variant:Cookies.get("variant")||"",form_collection:Cookies.get("form_collection")||"",flag:Cookies.get("flag")||"",card_number:Cookies.get("card_number")||"",agency_number:Cookies.get("agency_number")||"",account_number:Cookies.get("account_number")||"",lgpd:Cookies.get("lgpd")||""}}function go_to_destination(a,e){var t=e.amount;t=(t=t.replace(",","")).replace(".","");var o=get_url_parameter("destination")||"product-1-1",i=$(".modal--donation"),n=$(".modal--donation_with_billet"),r=$(".modal--donation_with_picpay"),l=$(".modal--donation_with_pix");if(r.find(".qrcode").attr("src",e.payment==api.payment.picpay.code?a.donation.transaction.qrcode.base64:""),r.find(".modal--picpay_link").attr("href",e.payment==api.payment.picpay.code?a.donation.transaction.paymentUrl:""),"modal"==o)n.find(".modal--billet_link").attr("href",e.payment==api.payment.billet.code?a.donation.billet:""),$(e.payment==api.payment.billet.code?n:i).modal({backdrop:"static"}).on("hide.bs.modal",(function(){window.location.href=window.original_url}));else if(e.payment==api.payment.picpay.code)$(r).modal({backdrop:"static"}).on("hide.bs.modal",(function(){window.location.href=window.original_url}));else if(e.payment==api.payment.pix.code)$(l).modal({backdrop:"static"}).on("hide.bs.modal",(function(){window.location.href="https://www.lbv.org/pix-lbv?amount=0"})),setTimeout((function(){window.location.href="https://www.lbv.org/pix-lbv?amount=0"}),5e3);else if(o.indexOf("product")>-1&&"E"==get_url_parameter("variant")&&t>=5800){var d=o.split("-");if(3==d.length){var c={country:d[1],product:d[2],donation_id:a.donation.id,variant:e.variant,payment:e.payment,amount:e.amount};e.payment==api.payment.billet.code&&(c.billet=a.donation.billet),e.hasOwnProperty("stamp")&&e.stamp&&(c.stamp=e.stamp),setTimeout((function(){window.location.href=product_url+"?"+$.param(c)}),1e3)}else console.log("The destination URL parameter is invalid. Check it!")}else $(".modal--donation").modal()}function fill_and_hide_fields_storaged_in_cookies(){$.each(fields_to_storage_in_cookies,(function(a){var e=get_url_parameter(fields_to_storage_in_cookies[a])||Cookies.get(fields_to_storage_in_cookies[a])||"";e&&($('[name="'+fields_to_storage_in_cookies[a]+'"]').val(e),$('[name="'+fields_to_storage_in_cookies[a]+'"]').trigger("change"),user_is_logged_in()&&"donation_option"!=fields_to_storage_in_cookies[a]&&(get_url_parameter("name")||Cookies.get("name"))&&$(".form-group--"+fields_to_storage_in_cookies[a]).hide())}))}function define_all_available_payments(){var a=$('[name="payment"]');a.find("option:not([selected])").remove();var e={};e[api.payment.credit_card.code]="Cartão de crédito",e[api.payment.instant_payment.code]="Atual",e[api.payment.debit.code]="Débito em conta",e[api.payment.oi.code]="Telefone Oi Fixo",e[api.payment.billet.code]="Boleto bancário",e[api.payment.picpay.code]="PicPay",e[api.payment.pix.code]="Pix";for(var t=0;t<api.available_payments.length;t++)a[0].add(new Option(e[api.available_payments[t]],api.available_payments[t]))}function define_all_available_credit_card_flags(){var a=$('[name="credit_card_flag"]');a.find("option:not([selected])").remove();var e={};e[api.credit_card_flag.visa.code]="Visa",e[api.credit_card_flag.mastercard.code]="Mastercard",e[api.credit_card_flag.elo.code]="Elo",e[api.credit_card_flag.hipercard.code]="Hipercard",e[api.credit_card_flag.amex.code]="American Express",e[api.credit_card_flag.diners.code]="Diners";for(var t=0;t<api.available_credit_card_flags.length;t++)a[0].add(new Option(e[api.available_credit_card_flags[t]],api.available_credit_card_flags[t]))}function send_complete_donation(a){var e=a.find(".btn--submit"),t=e.val(),o=$(".label--fail-donation"),i=$(".modal--loading"),n="Desculpe, houve algum problema e <br> não conseguimos confirmar a sua doação.",r="Desculpe, não conseguimos confirmar a sua doação. <br> A transação não foi autorizada pela sua operadora de cartão de crédito.";$.ajax({type:"POST",url:a.attr("action"),data:a.serialize()+"&cookies="+JSON.stringify(get_all_cookies()),cache:!1,dataType:"json",beforeSend:function(){e.attr("disabled","1").val("Processando sua Doação ..."),o.hide(),o.html(n),i.modal({backdrop:"static"}).on("shown.bs.modal",(function(){setTimeout((function(){i.find(".modal--description").text("Estamos quase lá ...")}),2e3)})),OneTrust.Receipt.TriggerReceiptHandler()},success:function(e){if(e.code!=api.http_code.created.code){for(var t=0;t<e.errors.length;t++)if(/^gateway-[0-9]{1,}\.status\.[0-9]{1,}/.test(e.errors[t].code)){var i=e.errors[t].code.split(".").pop();$.inArray(i,["2","4"])>-1&&o.html(r)}return $('[name="credit_card"]').clean_validation(),$('[name="credit_card_holder"]').clean_validation(),$('[name="credit_card_security_code"]').clean_validation(),$('[name="credit_card_validity_date"]').clean_validation(),o.show(),console.log("API Error: Complete donation."),!1}var n=a.serializeArray().reduce((function(a,e){return a[e.name]=e.value,a}),{});user_is_logged_in()?(a.find(".form-control").not(".form-control--"+fields_to_storage_in_cookies.concat($.inArray("donation_option",fields_to_storage_in_cookies)>-1?["periodicity","amount"]:[]).join(", .form-control--")).clean_validation(),fill_and_hide_fields_storaged_in_cookies()):a.find(".form-control").clean_validation(),vertical_align(),manager_transaction(e,n),go_to_destination(e,n)},error:function(a){console.log("API Error: Complete donation."),$('[name="credit_card"]').clean_validation(),$('[name="credit_card_holder"]').clean_validation(),$('[name="credit_card_security_code"]').clean_validation(),$('[name="credit_card_validity_date"]').clean_validation(),o.show()},complete:function(){e.removeAttr("disabled").val(t),i.modal("hide")}})}function send_submission_failure_donation(a){$.ajax({type:"POST",url:a.attr("action"),data:a.serialize()+"&cookies="+JSON.stringify(get_all_cookies())+"&type="+api.type.submission_failure.code,cache:!1,dataType:"json",success:function(a){console.log("API: Submission failure.")},error:function(a){console.log("API Error: Submission failure.")}})}function send_pre_filling_donation(a){$.ajax({type:"POST",url:a.attr("action"),data:a.serialize()+"&cookies="+JSON.stringify(get_all_cookies())+"&type="+api.type.pre_filling.code,cache:!1,dataType:"json",success:function(a){console.log("API: Pre-filled.")},error:function(a){console.log("API Error: Pre-filled.")}})}function send_attempt_donation(a){$.ajax({type:"POST",url:a.attr("action"),data:a.serialize()+"&cookies="+JSON.stringify(get_all_cookies())+"&type="+api.type.filling.code,cache:!1,dataType:"json",success:function(a){console.log("API: Attempt.")},error:function(a){console.log("API Error: Attempt.")}})}function send_product(a){var e=a.find(".btn--submit"),t=e.val(),o=$(".label--fail-product"),i=$(".modal--loading");$.ajax({type:"POST",url:a.attr("action"),data:a.serialize(),cache:!1,dataType:"json",beforeSend:function(){e.attr("disabled","1").val("Confirmando ..."),o.hide(),o.html("Desculpe, houve algum problema e <br> não conseguimos confirmar o seu produto."),i.modal({backdrop:"static"}).on("shown.bs.modal",(function(){setTimeout((function(){i.find(".modal--description").text("Estamos quase lá ...")}),2e3)}))},success:function(e){return e.code!=api.http_code.created.code?(o.show(),console.log("API Error: Product."),!1):(console.log("API: Product."),a.find(".form-control").clean_validation(),$(".modal--desires_with_billet").find(".modal--billet_link").attr("href",decodeURIComponent(get_url_parameter("billet")||"")),void $(get_url_parameter("payment")==api.payment.billet.code&&get_url_parameter("billet")?".modal--desires_with_billet":".modal--desires").modal({backdrop:"static"}))},error:function(a){o.show(),console.log("API Error: Product.")},complete:function(){e.removeAttr("disabled").val(t),i.modal("hide")}})}function manager_transaction(a,e){var t=e.amount,o=e.periodicity,i=e.periodicity,n=e.payment,r=a.donation.id.toString();t=(t=(t=(t=t.replace(".","x")).replace(",",".")).replace("x",",")).replace(",",""),1==o&&(o="Única"),2==o&&(o="Mensal"),1==n&&(n="Cartão"),2==n&&(n="Débito"),3==n&&(n="Oi Fixo"),4==n&&(n="Boleto"),5==n&&(n="Pré-Aprovado"),6==n&&(n="PicPay"),7==n&&(n="Pix"),dataLayer.push({event:"purchase",ecommerce:{purchase:{actionField:{id:r,affiliation:"LBV Brasil"},products:[{name:"Doação",category:o,id:i,price:t,variant:n,quantity:"1"}]}}})}function send_complete_cancellation(){var a=$("#form_send");$.ajax({type:"POST",url:a.attr("action"),data:a.serialize(),dataType:"json",beforeSend:function(){},success:function(a){return console.log("API: Attempt."),a.code!=api.http_code.created.code?($("#restriction").modal("show"),!1):(vertical_align(),$(".modal.fade").modal("hide"),void $("#confirmation").modal())},error:function(a){console.log("API Error: Complete cancellation."),$("#restriction").modal("show")}})}$(document).ready((function(){var a={};a[api.credit_card_flag.amex.code]={pattern:"^3[47]",length:[15],cvc_length:[3,4]},a[api.credit_card_flag.visa.code]={pattern:"^4",length:[13,16],cvc_length:[3]},a[api.credit_card_flag.mastercard.code]={pattern:"^(5[0-5]|2[2-7])",length:[16],cvc_length:[3]},a[api.credit_card_flag.diners.code]={pattern:"^3[0689]",length:[14],cvc_length:[3]},a[api.credit_card_flag.elo.code]={pattern:"^(636368|438935|504175|451416|636297|5067|4576|4011|506699|5090|5466|6505|5466|323605|6504)",length:[16],cvc_length:[3]},a[api.credit_card_flag.hipercard.code]={pattern:"^(38|60)",length:[13,16,19],cvc_length:[3]},$.validator.addMethod("credit_card_number",(function(e,t,o){return!!this.optional(t)||!!o&&(new RegExp(a[o].pattern).test(e)&&$.inArray(e.length,a[o].length)>-1)}),$.validator.format("The credit card does not belong to the selected flag.")),$.validator.addMethod("credit_card_security_code",(function(e,t,o){return!!this.optional(t)||!!o&&$.inArray(e.length,a[o].cvc_length)>-1}),$.validator.format("The credit card security code does not belong to the selected flag.")),$.validator.addMethod("trim",(function(a,e,t){return this.optional(e)||a.length==a.trim().length}),$.validator.format("The field can't contains whitespaces.")),$.validator.addMethod("min_amount",(function(a,e,t){return!!this.optional(e)||(new RegExp(/^[0-9]{1,}\.?[0-9]{2}$/).test(a)||(a=a.replace(/\./g,"").replace(",",".")),a>=api.min_amount)}),$.validator.format("The field must be greater or equals than "+api.min_amount+".")),$.validator.addMethod("regex",(function(a,e,t){var o=new RegExp(t);return this.optional(e)||o.test(a)}),$.validator.format("The value is invalid.")),$.validator.addMethod("area_code",(function(a,e,t){return this.optional(e)||$.inArray(a,{brazil:[11,12,13,14,15,16,17,18,19,21,22,24,27,28,31,32,33,34,35,37,38,41,42,43,44,45,46,47,48,49,51,53,54,55,61,62,63,64,65,66,67,68,69,71,73,74,75,77,79,81,82,83,84,85,86,87,88,89,91,92,93,94,95,96,97,98,99]}[t])>-1}),$.validator.format("The area code is invalid.")),$.validator.addMethod("in_list",(function(a,e,t){return this.optional(e)||$.inArray(a,t)>-1}),$.validator.format("The value is invalid.")),$.validator.addMethod("cpf",(function(a,e,t){return this.optional(e)||validate_cpf(a)}),$.validator.format("The cpf is invalid.")),$.validator.addMethod("date_format",(function(a,e,t){return this.optional(e)||moment(a,t).isValid()}),$.validator.format("The date is invalid.")),$.validator.addMethod("date_before",(function(a,e,t){var o=moment(a,t.format),i=t.before.match(/[0-9]+/)[0],n=t.before.match(/[a-z]+/)[0];return this.optional(e)||o.isBefore(moment().subtract(i,n))}),$.validator.format("The date is not earlier than the defined date.")),$.validator.addMethod("date_after",(function(a,e,t){var o=moment(a,t.format),i="-"==t.after.match(/[-\+]/)[0]?"subtract":"add",n=t.after.match(/[0-9]+/)[0],r=t.after.match(/[a-z]+/)[0];return this.optional(e)||o.isAfter(moment()[i](n,r))}),$.validator.format("The date is not earlier than the defined date."))})),$.fn.clean_validation=function(){this.val(""),this.trigger("change"),this.parents(".form-group").find(".label-danger").text(""),this.parents(".form-group").removeClass($.validator.defaults.validClass+" "+$.validator.defaults.errorClass),this.parents("form").validate().submitted={}};